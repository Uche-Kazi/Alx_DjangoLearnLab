{% extends 'base.html' %} {# Extends the project's base template #}

{% block title %}My Profile{% endblock %} {# Sets the page title #}

{% block content %}
<div class="flex items-start justify-center min-h-screen -mt-16"> {# Positions content, aligns to top if content is short #}
    <div class="w-full max-w-2xl bg-white rounded-lg shadow-xl p-8 m-4"> {# Styles the main profile container #}
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">My Profile</h1>

        <!-- Current Profile Information Display Section -->
        <div class="text-gray-700 mb-8 p-4 bg-gray-50 rounded-md">
            <p class="mb-2"><span class="font-semibold">Username:</span> {{ user.username }}</p>
            <p class="mb-2"><span class="font-semibold">Email:</span> {{ user.email }}</p>
            <p class="mb-2"><span class="font-semibold">Date Joined:</span> {{ user.date_joined|date:"F d, Y" }}</p>
            <div class="flex items-center mb-2">
                <span class="font-semibold mr-2">Profile Picture:</span>
                {# Display profile picture if user.profile.profile_picture exists #}
                {% if user.profile.profile_picture %}
                    <img src="{{ user.profile.profile_picture.url }}" alt="Profile Picture" class="w-24 h-24 rounded-full object-cover border-2 border-indigo-300">
                {% else %}
                    {# Placeholder image if no profile picture is set. Uses placehold.co for a dynamic placeholder. #}
                    <img src="https://placehold.co/100x100/eeeeee/000000?text=No+Image" alt="No Profile Picture" class="w-24 h-24 rounded-full object-cover border-2 border-gray-300">
                {% endif %}
            </div>
            {# Display user's bio, with a default message if empty #}
            <p><span class="font-semibold">Bio:</span> {{ user.profile.bio|default:"No bio yet." }}</p>
        </div>

        <!-- Section for Editing Profile Details (Bio and Profile Picture) -->
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Edit Profile Details</h2>
        <form method="post" enctype="multipart/form-data" class="space-y-4 mb-8">
            {% csrf_token %}
            {# Iterate through fields of the profile_form (for Bio and Profile Picture) #}
            {% for field in profile_form %}
                <div class="mb-4">
                    <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700">
                        {{ field.label }}
                    </label>
                    {{ field }} {# Render the input field itself #}
                    {% if field.help_text %}
                        <p class="mt-1 text-sm text-gray-500">{{ field.help_text }}</p>
                    {% endif %}
                    {% for error in field.errors %}
                        <p class="mt-2 text-sm text-red-600">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endfor %}
            {# Submit button for this specific form. 'name' attribute helps distinguish forms in views.py #}
            <button type="submit" name="update_profile_details" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Update Profile Details
            </button>
        </form>

        <!-- Section for Changing Email -->
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Change Email</h2>
        <form method="post" class="space-y-4 mb-8">
            {% csrf_token %}
            {# Iterate through fields of the user_form (for Email) #}
            {% for field in user_form %}
                <div class="mb-4">
                    <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700">
                        {{ field.label }}
                    </label>
                    {{ field }}
                    {% if field.help_text %}
                        <p class="mt-1 text-sm text-gray-500">{{ field.help_text }}</p>
                    {% endif %}
                    {% for error in field.errors %}
                        <p class="mt-2 text-sm text-red-600">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endfor %}
            {# Submit button for this specific form #}
            <button type="submit" name="update_user_email" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Change Email
            </button>
        </form>

        <!-- Section for Changing Password -->
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Change Password</h2>
        <form method="post" class="space-y-4">
            {% csrf_token %}
            {# Iterate through fields of the password_form #}
            {% for field in password_form %}
                <div class="mb-4">
                    <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700">
                        {{ field.label }}
                    </label>
                    {{ field }}
                    {% if field.help_text %}
                        <p class="mt-1 text-sm text-gray-500">{{ field.help_text }}</p>
                    {% endif %}
                    {% for error in field.errors %}
                        <p class="mt-2 text-sm text-red-600">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endfor %}
            {# Submit button for this specific form #}
            <button type="submit" name="change_password" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                Change Password
            </button>
        </form>

        {# Simple note about account deletion (as it's often handled in admin or separate flow for security) #}
        <p class="mt-8 text-center text-sm text-gray-600">
            Need to delete your account? This functionality is not directly provided on this page for security reasons. Please contact support.
        </p>
    </div>
</div>
{% endblock %}
